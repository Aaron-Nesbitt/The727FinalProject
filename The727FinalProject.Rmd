---
title: "727 Final Project: "
author: "Aaron Nesbitt and Jessica Valencia"
date: '2022-12-01'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(readr)
library(dplyr)
library(rtweet)
library(ggplot2)
library(plyr)
library(tidyverse)
library(tidytext)
library(ggmap)
library(rJava)
library(qdap)
library(SentimentAnalysis)
```

#INTRODUCTION#############################################################
For our project we put ourselves in the position of marketing strategist for a company and as part of our current strategy on a project, we plan to use Twitter. However, there has been polarity in opinions when it comes to the recent news of Elon Musk buying Twitter. Therefore, we want to get a better sense of how Twitter users feel about this change through a sentiment analysis, considering it could affect the success of our marketing plan if we were to use Twitter. In order to look further into this, the research question we plan to answer is, "How do Twitter users feel about Elon Musk buying Twitter?". We plan to explore this question using word clouds as well as bar plots. 

#DATA#######################################
As part of our data collection process, we used Twitter as our data source and first identified key words that will help us scrape the proper data for this analysis. The words we decided to use to scrape the proper data were "Musk" and "Twitter". Once we identified our key words, we then collected the data using rtweet package in R. We searched for original tweets not counting retweets as tweets, allowing for up to 18 thousand. We ran the function at 5 pm on Tuesday November 29th. We collected 17,412 tweets. 

```{r}
#musktweetsfinal <- read_csv("C:\\Users\\valen\\Downloads\\musktweetsfinal.csv")
musktweetsfinal <- read_csv("C:\\Users\\aanes\\Downloads\\muskTweets.csv")
```

```{r eval=FALSE, include=FALSE}
#musk <- search_tweets(
#  q = "musk Twitter, lang:en",
#  n = 18000,
#  include_rts = FALSE
)
```

#DATA_ANALYSIS/EXPLORATION###############################################
```{r}
frequent_terms = freq_terms(musktweetsfinal["text"], 30)
plot(frequent_terms)
```

```{r}
musktweetsfinal$bagAllTweets = musktweetsfinal$text %>% iconv("latin1", "ASCII", sub="") %>% scrubber() %sw% qdapDictionaries::Top200Words
```

```{r}
frequent_terms2 = freq_terms(musktweetsfinal["bagAllTweets"], 30)
plot(frequent_terms2)
```
```{r}
frequent_terms3 = freq_terms(musktweetsfinal["bagAllTweets"], 100)
```

```{r}
freq_terms3_less <- frequent_terms3[-c(1,2,3,4,5,6,8),]
```

```{r}
library(wordcloud)
library(RColorBrewer)
```

```{r}
set.seed(4356)
wordcloud(words = freq_terms3_less$WORD, freq = freq_terms3_less$FREQ, min.freq = 5,
          max.words=100, random.order=FALSE, rot.per=0.40, 
          colors=brewer.pal(8, "Dark2"))
```

```{r, cache=TRUE}
library(SentimentAnalysis)
sentimentsAll = analyzeSentiment(iconv(as.character(musktweetsfinal$bagAllTweets), to='UTF-8'))
head(sentiments)
```

```{r}
library(syuzhet)
```

```{r}
emotionsALL<-get_nrc_sentiment(musktweetsfinal$bagAllTweets)

```

```{r}
emotionsALLt<-data.frame(t(emotionsALL))
#The function rowSums computes column sums across rows for each level of a grouping variable.
#plotemot <- data.frame(rowSums(emotionsALLt[1:10, 1:17412]))

sentiment <- c("anger", "anticipation", "disgust", "fear", "joy", "sadness", "suprise", "trust", "negative", "postitive")
count <- c(8500, 7995, 5374, 9296, 5726, 6836, 3328, 10627, 15611, 18394)

plotemot <- data.frame(sentiment, count)

plotemot2<-plotemot[1:8,]


quickplot(sentiment, data=plotemot2, weight=count, geom="bar", fill=sentiment, ylab="count")+ggtitle("Survey sentiments")

```

```{r}
write.csv(emotionsALL, "C:/Users/aanes/Documents/emotionsAll.csv")
write.csv(sentimentsAll, "C:/Users/aanes/Documents/sentimentsAll.csv")
```

#apple
```{R}
apple_tweets = musktweetsfinal%>%filter(str_detect(str_to_lower(text), "apple") == TRUE)
```

```{r}
frequent_terms_apple = freq_terms(apple_tweets["text"], 30)
plot(frequent_terms_apple)
```

```{r}
apple_tweets$bagAllTweets = apple_tweets$text %>% iconv("latin1", "ASCII", sub="") %>% scrubber() %sw% qdapDictionaries::Top200Words
```

```{r}
frequent_terms_apple1 = freq_terms(apple_tweets["bagAllTweets"], 30)
plot(frequent_terms_apple1)
```
```{r}
frequent_terms_apple2 = freq_terms(apple_tweets["bagAllTweets"], 100)
```

```{r}
freq_terms_apple2_less <- frequent_terms_apple2[-c(1,2,3,4,5,6,7),]
```

```{r}
#install.packages("wordcloud")
#install.packages("RColorBrewer")

library(wordcloud)
library(RColorBrewer)
```

```{r}
set.seed(4356)
wordcloud(words = freq_terms_apple2_less$WORD, freq = freq_terms_apple2_less$FREQ, min.freq = 5,
          max.words=100, random.order=FALSE, rot.per=0.40, 
          colors=brewer.pal(8, "Dark2"))
```

```{r, cache=TRUE}
library(SentimentAnalysis)
sentimentsAll_apple = analyzeSentiment(iconv(as.character(apple_tweets$bagAllTweets), to='UTF-8'))
```

```{r}
hist(sentimentsAll_apple$SentimentQDAP,
main="Distribution of SentimentQDAP scores",
xlab="SentimentQDAP",
col="tomato1"
)
```


```{r}
#install.packages("syuzhet")
library(syuzhet)
```

```{r}
emotionsALL_apple<-get_nrc_sentiment(apple_tweets$bagAllTweets)

```

```{r}
emotionsALLt_apple<-data.frame(t(emotionsALL_apple))
#The function rowSums computes column sums across rows for each level of a grouping variable.
#plotemot_apple <- data.frame(rowSums(emotionsALLt_apple[1:10,1:3264]))

sentiment <- c("anger", "anticipation", "disgust", "fear", "joy", "sadness", "suprise", "trust", "negative", "postitive")
count2 <- c(2304, 2027, 1073, 2450, 886, 1622, 525, 1626, 3700, 3868)

plotemot_apple <- data.frame(sentiment, count2)
plotemot_apple2<-plotemot_apple[1:8,]

quickplot(sentiment, data=plotemot_apple2, weight=count2, geom="bar", fill=sentiment, ylab="count")+ggtitle("Survey sentiments")

```
```{r}
write.csv(emotionsALL, "C:/Users/aanes/Documents/emotionsAll.csv")
write.csv(sentimentsAll, "C:/Users/aanes/Documents/sentimentsAll.csv")
```

#covid

```{R}
covid_tweets = musktweetsfinal%>%filter(str_detect(str_to_lower(text), "covid") == TRUE)
```

```{r}
frequent_terms_covid = freq_terms(covid_tweets["text"], 30)
plot(frequent_terms_covid)
```

```{r}
covid_tweets$bagAllTweets = covid_tweets$text %>% iconv("latin1", "ASCII", sub="") %>% scrubber() %sw% qdapDictionaries::Top200Words
```

```{r}
frequent_terms_covid1 = freq_terms(covid_tweets["bagAllTweets"], 30)
plot(frequent_terms_covid1)
```

```{r}
frequent_terms_covid2 = freq_terms(covid_tweets["bagAllTweets"], 100)
```

```{r}
freq_terms_covid2_less <- frequent_terms_covid2[-c(1,2,3,4,5,6,8),]
```

```{r}
#install.packages("wordcloud")
#install.packages("RColorBrewer")

library(wordcloud)
library(RColorBrewer)
```

```{r}
set.seed(4356)
wordcloud(words = freq_terms_covid2_less$WORD, freq = freq_terms_covid2_less$FREQ, min.freq = 5,
          max.words=100, random.order=FALSE, rot.per=0.40, 
          colors=brewer.pal(8, "Dark2"))
```

```{r, cache=TRUE}
sentimentsAll_covid = analyzeSentiment(iconv(as.character(covid_tweets$bagAllTweets), to='UTF-8'))
```

```{r}
hist(sentimentsAll_covid$SentimentQDAP,
main="Distribution of SentimentQDAP scores",
xlab="SentimentQDAP",
col="cyan3"
)
```



```{r}
#install.packages("syuzhet")
library(syuzhet)
```

```{r}
emotionsALL_covid<-get_nrc_sentiment(covid_tweets$bagAllTweets)

```

```{r}
emotionsALLt_covid<-data.frame(t(emotionsALL_covid))
#The function rowSums computes column sums across rows for each level of a grouping variable.
#plotemot_covid <- data.frame(rowSums(emotionsALLt_covid[1:10,1:624]))

sentiment <- c("anger", "anticipation", "disgust", "fear", "joy", "sadness", "suprise", "trust", "negative", "postitive")
count3 <- c(313, 209, 172, 370, 134, 191, 94, 704, 539, 539)

plotemot_covid <- data.frame(sentiment, count3)
plotemot_covid2<-plotemot_covid[1:8,]

quickplot(sentiment, data=plotemot_covid2, weight=count3, geom="bar", fill=sentiment, ylab="count")+ggtitle("Survey sentiments")

```


# Vader comparison 
```{r}
library(vader)
vader_scores_covid = vader_df(covid_tweets$text)
```
```{r}
vader_scores_apple = vader_df(apple_tweets$text)
```

```{r}
vader_scores_apple2 <- vader_scores_apple %>%
  add_column(tweet_word = "apple")
```
```{r}
vader_scores_covid2 <- vader_scores_covid %>%
  add_column(tweet_word = "covid")
```

```{r}
vader_apple_covid <- rbind(vader_scores_apple2, vader_scores_covid2)
```

```{r}
mean(vader_scores_apple$compound)
mean(vader_scores_covid$compound)

```


```{r}
vader_plot<-ggplot(vader_apple_covid, aes(x=compound, color=tweet_word)) +
  geom_density(position="dodge")+
  geom_vline(xintercept = -0.1599877, colour="tomato1", linetype = "longdash")+
  geom_vline(xintercept = -0.3754423, colour="cyan3", linetype = "longdash")+
  theme(legend.position="top")
vader_plot
```


#RESULTS/DISCUSSION#######################################

The first bar graph we created measures the frequency of words in our data set.  We decided to remove stop words in order to get a better representation of the important words that are prevalent in our data. The second bar graph was after we cleaned our data which showed a high prevalence of the words twitter, musk, apple, and covid. We created a word cloud from this data where we found that the word “free elonmusk” was the most prevalent in our data set. Also, This was associated with the words “misinformation”, “hate”, and “money” which we found interesting. We decided to conduct a sentiment analysis bar graph of this data set and found that trust was the highest sentiment detected within the data following with fear. We found this results to be contradicting so we decided to further our analysis.

Since we initially found a high prevalence of covid and apple in our data set, we thought it would be interesting to further look into this correlation. We conducted a word cloud for apple where we found associated words such as, “framing”, “boycotting”, and “violating”. We found that the association of apple, musk, and twitter to have a negative sentiment but we decided to verify this and further investigate through a sentiment bar graph. As anticipated, the highest sentiment value associated to apple, elon musk, and twitter is fear being the highest and anger being the second highest. We found these results to be interesting considering the current news that Apple might potentially remove Twitter from the app store. This makes us believe that twitter users are upset about the news. 

We continued our analysis by looking into the association between covid, musk, and twitter. We found “misinformation” to be the most present word in our word cloud along with “policing” and “suspended”. This compelled us to conduct a sentiment bar graph where we found a significant difference between the sentiments where trust was detected the most, followed by fear and anger. However, trust showed up twice as much than any other sentiment in this analysis. We find according to the word cloud and sentiment bar graph, a lack of trust could be detected here.

(CAN YOU EXPLAIN THE LAST 3 GRAPHS HERE) 


Overall, through our analysis we can say that there is a higher prevalence of negative sentiment towards elon musk and twitter than positive sentiment. As marketing strategists, it would not be ideal to utilize Twitter as part of our marketing strategy. 



#RESOURCES#####################################
